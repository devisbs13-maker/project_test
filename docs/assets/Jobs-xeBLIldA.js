import{r as g,n as z,j as t,s as q}from"./index-DVXwuRvp.js";import{H as L}from"./Header-DA9LU_SU.js";import{B as v}from"./Button-ZX7veED-.js";import{l as W,s as p,i as k,a as w,T as X,g as A}from"./progression-D0AxwT99.js";import{r as j,n as h,s as G}from"./time-WGOIUK2d.js";function F({player:d,onBack:R,onUpdatePlayer:u}){const[r,c]=g.useState(()=>W()),x=g.useMemo(()=>new Map(r.tasks.map(e=>[e.id,e])),[r.tasks]),b=g.useMemo(()=>r.active.filter(e=>e.kind==="job"),[r.active]),S=g.useMemo(()=>r.tasks.filter(e=>e.kind==="job"),[r.tasks,d.progress.level]);g.useEffect(()=>{const e=setInterval(()=>{const i=r.active.filter(a=>j(a.endsAt)<=0);if(i.length===0)return;const s=r.active.filter(a=>j(a.endsAt)>0),n=[...r.vault];for(const a of i){const o=x.get(a.id);o&&(n.push({id:o.id,kind:"job",title:o.title,reward:o.reward,completedAt:h()}),z("job",o.title,o.reward))}const l={...r,active:s,vault:n};c(l),p(l)},1e3);return()=>clearInterval(e)},[r,x]);function T(e){return r.active.filter(i=>i.kind===e).length}function C(e){var l;try{if(k(w())){alert("Ð¡ÐµÐ¹Ñ‡Ð°Ñ Ð¸Ð´ÐµÑ‚ Ð±Ð¾Ð¹ Ñ Ð¼Ð¾Ð½ÑÑ‚Ñ€Ð¾Ð¼. Ð Ð°Ð±Ð¾Ñ‚Ð° Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð°.");return}}catch(a){}const i=(l=e.costEnergy)!=null?l:0;if(i>0&&d.energy<i){alert("ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ ÑÐ½ÐµÑ€Ð³Ð¸Ð¸");return}if(T("job")>=r.limits.job){alert("Ð”Ð¾ÑÑ‚Ð¸Ð³Ð½ÑƒÑ‚ Ð»Ð¸Ð¼Ð¸Ñ‚ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ… Ñ€Ð°Ð±Ð¾Ñ‚: ".concat(r.limits.job));return}const s={id:e.id,kind:"job",startedAt:h(),endsAt:h()+G(e.durationSec)},n={...r,active:[...r.active,s]};if(c(n),p(n),i>0){const a={...d,energy:Math.max(0,d.energy-i)};q(a),u(a)}}function I(e){const i=r.active.filter(n=>!(n.kind==="job"&&n.id===e.id&&n.startedAt===e.startedAt)),s={...r,active:i};c(s),p(s)}function B(e){const i=r.vault.filter(l=>l!==e),s={...r,vault:i};c(s),p(s);const n=A(d,e.reward);u(n)}function E(){let e=d;for(const s of r.vault)e=A(e,s.reward);u(e);const i={...r,vault:[]};c(i),p(i)}return t.jsxs("div",{style:{padding:16,display:"grid",gap:12},children:[(()=>{try{return k(w())}catch(e){return!1}})()&&t.jsxs("section",{style:{padding:12,borderRadius:16,background:"var(--panel-bg)",border:"var(--panel-border)"},children:[t.jsx("b",{children:"Ð¡ÐµÐ¹Ñ‡Ð°Ñ Ð¸Ð´ÐµÑ‚ Ð±Ð¾Ð¹ Ñ Ð¼Ð¾Ð½ÑÑ‚Ñ€Ð¾Ð¼"}),t.jsx("div",{style:{opacity:.85,marginTop:6},children:"Ð’Ð¾ Ð²Ñ€ÐµÐ¼Ñ Ð±Ð¾Ñ Ð½ÐµÐ»ÑŒÐ·Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ. Ð’ÐµÑ€Ð½Ð¸Ñ‚ÐµÑÑŒ Ð¿Ð¾ÑÐ»Ðµ Ð¾ÐºÐ¾Ð½Ñ‡Ð°Ð½Ð¸Ñ Ð±Ð¾Ñ."})]}),t.jsx(L,{title:"Ð Ð°Ð±Ð¾Ñ‚Ð°",gold:d.gold,energy:d.energy,level:d.progress.level,onBack:R}),t.jsxs("section",{style:{padding:12,borderRadius:16,background:"var(--panel-bg)",border:"var(--panel-border)"},children:[t.jsx("b",{children:"ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸"}),t.jsxs("div",{style:{display:"grid",gap:8,marginTop:8},children:[b.length===0&&t.jsx("div",{style:{opacity:.8},children:"ÐŸÐ¾ÐºÐ° Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ."}),b.map(e=>{var s,n;const i=x.get(e.id);return i?t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 12px",borderRadius:12,background:"var(--panel-bg)",border:"1px solid rgba(255,255,255,0.08)"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:700},children:i.title}),t.jsxs("div",{style:{opacity:.85,fontSize:12},children:["Ð’Ñ‹Ð¿Ð»Ð°Ñ‚Ð°: ðŸª™ ",(s=i.reward.gold)!=null?s:0," â€¢ XP ",(n=i.reward.xp)!=null?n:0]})]}),t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsx(X,{endsAt:e.endsAt}),t.jsx(v,{onClick:()=>I(e),disabled:j(e.endsAt)<2e3,children:"ÐžÑ‚Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ"})]})]},e.startedAt+e.id):null})]})]}),t.jsxs("section",{style:{padding:12,borderRadius:16,background:"var(--panel-bg)",border:"var(--panel-border)"},children:[t.jsx("b",{children:"Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸"}),t.jsx("div",{style:{display:"grid",gap:8,marginTop:8},children:S.map(e=>{var n,l,a,o,y,f,m;const i=!!b.find(M=>M.id===e.id),s=((n=e.costEnergy)!=null?n:0)>d.energy||i||d.progress.level<((l=e.requiredLevel)!=null?l:1);return t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 12px",borderRadius:12,background:"var(--panel-bg)",border:"1px solid rgba(255,255,255,0.08)"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:700},children:e.title}),t.jsx("div",{style:{opacity:.85,fontSize:12},children:e.desc}),d.progress.level<((a=e.requiredLevel)!=null?a:1)&&t.jsxs("div",{style:{opacity:.85,fontSize:12,marginTop:4,color:"#e7a"},children:["Ð¢Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ ÑƒÑ€. ",(o=e.requiredLevel)!=null?o:1]}),t.jsxs("div",{style:{opacity:.85,fontSize:12,marginTop:4},children:["Ð”Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ: ",e.durationSec/60," Ð¼Ð¸Ð½ â€¢ Ð¦ÐµÐ½Ð°: âš¡ ",(y=e.costEnergy)!=null?y:0," â€¢ Ð’Ñ‹Ð¿Ð»Ð°Ñ‚Ð°: ðŸª™ ",(f=e.reward.gold)!=null?f:0," â€¢ XP ",(m=e.reward.xp)!=null?m:0]})]}),t.jsx(v,{disabled:s,onClick:()=>C(e),children:i?"Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ":"ÐÐ°Ñ‡Ð°Ñ‚ÑŒ"})]},e.id)})})]}),t.jsxs("section",{style:{padding:12,borderRadius:16,background:"var(--panel-bg)",border:"var(--panel-border)"},children:[t.jsx("b",{children:"Ð¡ÐºÐ»Ð°Ð´ Ð½Ð°Ð³Ñ€Ð°Ð´"}),t.jsx("div",{style:{display:"flex",gap:8,marginTop:8},children:t.jsx(v,{onClick:E,disabled:r.vault.length===0,children:"Ð—Ð°Ð±Ñ€Ð°Ñ‚ÑŒ Ð²ÑÑ‘"})}),t.jsxs("div",{style:{display:"grid",gap:8,marginTop:10},children:[r.vault.length===0&&t.jsx("div",{style:{opacity:.8},children:"ÐŸÑƒÑÑ‚Ð¾."}),r.vault.map(e=>{var i,s;return t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 12px",borderRadius:12,background:"var(--panel-bg)",border:"1px solid rgba(255,255,255,0.08)"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:700},children:e.title}),t.jsxs("div",{style:{opacity:.85,fontSize:12},children:["ÐÐ°Ð³Ñ€Ð°Ð´Ð°: ðŸª™ ",(i=e.reward.gold)!=null?i:0," â€¢ XP ",(s=e.reward.xp)!=null?s:0,e.reward.energy?" â€¢ ÑÐ½ÐµÑ€Ð³Ð¸Ñ +".concat(e.reward.energy):""]})]}),t.jsx(v,{onClick:()=>B(e),children:"Ð—Ð°Ð±Ñ€Ð°Ñ‚ÑŒ"})]},e.completedAt+e.id)})]})]})]})}export{F as default};
