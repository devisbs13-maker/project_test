!function(){function e(r){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(r)}function r(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||o(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,t)}return n}function t(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?n(Object(t),!0).forEach(function(r){i(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function i(r,n,t){return(n=function(r){var n=function(r,n){if("object"!=e(r)||!r)return r;var t=r[Symbol.toPrimitive];if(void 0!==t){var i=t.call(r,n||"default");if("object"!=e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(r)}(r,"string");return"symbol"==e(n)?n:n+""}(n))in r?Object.defineProperty(r,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[n]=t,r}function l(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var t,i,l,o,a=[],d=!0,c=!1;try{if(l=(n=n.call(e)).next,0===r){if(Object(n)!==n)return;d=!1}else for(;!(d=(t=l.call(n)).done)&&(a.push(t.value),a.length!==r);d=!0);}catch(e){c=!0,i=e}finally{try{if(!d&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return a}}(e,r)||o(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,r){if(e){if("string"==typeof e)return a(e,r);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,r):void 0}}function a(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=Array(r);n<r;n++)t[n]=e[n];return t}System.register(["./index-legacy-DqIMhorD.js","./Header-legacy-DWRb-Zh_.js","./Button-legacy-CPbMXTUf.js","./catalog-legacy-B8sB8at-.js","./index-legacy-ConR_zjY.js","./ru-legacy-DKJfoWCU.js"],function(e,n){"use strict";var i,a,d,c,s,u,y,v;return{setters:[function(e){i=e.r,a=e.j,d=e.s,c=e.n},function(e){s=e.H},function(e){u=e.B},function(e){y=e.C},function(e){v=e.g},null],execute:function(){e("default",function(e){var o,h,S,w,k,M,O,I,R,P,q,C,A,B,L=e.player,W=e.onBack,z=e.onUpdatePlayer,T=v(),D=l(i.useState("buy"),2),E=D[0],N=D[1],_=l(i.useState("resources"),2),F=_[0],J=_[1],$=l(i.useState("all"),2),H=($[0],$[1],l(i.useState(function(){var e=function(){try{var e=localStorage.getItem(n);return e?JSON.parse(e):null}catch(r){return null}}();if(!e||e.dateKey!==b()){var r=j(L);return f(r),r}return e}),2)),K=H[0],U=H[1],G=i.useMemo(function(){return new Map(y.map(function(e){return[e.id,e]}))},[]);try{var Q=K.offers.filter(function(e){return G.has(e.itemId)});if(K.offers.length>0&&0===Q.length){var V=j(L);f(V),U(V)}}catch(ne){}function X(e){var n=G.get(e);if(n){var i=p("buy",Math.round(n.basePrice*g(n.rarity)),L);if(!(L.gold<i)){var l={id:n.id,name:n.name,slot:n.slot,rarity:n.rarity,requiredLevel:n.requiredLevel,classReq:n.classReq},o=t(t({},L),{},{gold:L.gold-i,inventory:[].concat(r(L.inventory),[l])});d(o),z(o);try{var a,s,u,y;c("quest",null!==(a=null===(s=T.merchant)||void 0===s?void 0:s.purchase)&&void 0!==a?a:"Purchase",{gold:-i});var v=null===(u=window.Telegram)||void 0===u?void 0:u.WebApp;null==v||null===(y=v.sendData)||void 0===y||y.call(v,JSON.stringify({type:"purchase",title:n.name,price:i,qty:1}))}catch(f){}}}}var Y=new Set(["helmet","chest","pants","boots","gloves","weapon"]),Z=i.useMemo(function(){return y.filter(function(e){return Y.has(e.slot)&&"weapon"!==e.slot})},[]),ee=i.useMemo(function(){return y.filter(function(e){return"misc"===e.slot})},[]),re=i.useMemo(function(){return y.filter(function(e){return"weapon"===e.slot})},[]);return a.jsxs("div",{style:{display:"grid",gap:12,padding:16},children:[a.jsx(s,{title:null!==(o=null===(h=T.buttons)||void 0===h?void 0:h.merchant)&&void 0!==o?o:"Merchant",gold:L.gold,energy:L.energy,level:L.progress.level,onBack:W}),a.jsxs("div",{style:{display:"flex",gap:8},children:[a.jsx(u,{onClick:function(){return N("buy")},disabled:"buy"===E,children:null!==(S=null===(w=T.merchant)||void 0===w?void 0:w.buy)&&void 0!==S?S:"Buy"}),a.jsx(u,{onClick:function(){return N("sell")},disabled:"sell"===E,children:null!==(k=null===(M=T.merchant)||void 0===M?void 0:M.sell)&&void 0!==k?k:"Sell"})]}),"buy"===E&&a.jsxs("section",{style:{padding:12,borderRadius:16,background:"var(--panel-bg)",border:"var(--panel-border)"},children:[a.jsxs("div",{style:{display:"flex",gap:8,marginBottom:8},children:[a.jsx(u,{onClick:function(){return J("resources")},disabled:"resources"===F,children:null!==(O=null===(I=T.merchant)||void 0===I?void 0:I.resources)&&void 0!==O?O:"Resources"}),a.jsx(u,{onClick:function(){return J("clothing")},disabled:"clothing"===F,children:null!==(R=null===(P=T.merchant)||void 0===P?void 0:P.armor)&&void 0!==R?R:"Armor"})]}),a.jsx("div",{style:{display:"flex",gap:8,marginBottom:8},children:a.jsx(u,{onClick:function(){return J("weapons")},disabled:"weapons"===F,children:null!==(q=null===(C=T.merchant)||void 0===C?void 0:C.weapons)&&void 0!==q?q:"Weapons"})}),"resources"===F&&a.jsx("div",{style:{display:"grid",gap:8,marginBottom:12},children:ee.map(function(e){var r,n,t,i,l=p("buy",Math.round(e.basePrice*g(e.rarity)),L),o=L.gold<l;return a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 12px",borderRadius:12,background:"var(--panel-bg)",border:"1px solid rgba(255,255,255,0.08)"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.image?a.jsx("img",{src:e.image,alt:e.name,style:{width:32,height:32,objectFit:"cover",borderRadius:6}}):a.jsx("div",{style:{width:32,height:32,borderRadius:6,background:"rgba(255,255,255,0.07)"}}),a.jsxs("div",{children:[a.jsxs("div",{style:{fontWeight:700},children:[e.name," ",a.jsxs("span",{style:{color:x(e.rarity),fontSize:12,marginLeft:6},children:["Rarity: ",e.rarity]})]}),a.jsxs("div",{style:{opacity:.85,fontSize:12},children:[null!==(r=null===(n=T.merchant)||void 0===n?void 0:n.price)&&void 0!==r?r:"Price",": ",l]})]})]}),a.jsx(u,{onClick:function(){return X(e.id)},disabled:o,children:null!==(t=null===(i=T.merchant)||void 0===i?void 0:i.buy)&&void 0!==t?t:"Buy"})]},e.id)})}),"clothing"===F&&a.jsx("div",{style:{display:"grid",gap:12,marginBottom:12},children:["warrior","volkhv","hunter"].map(function(e){return a.jsx("div",{style:{display:"grid",gap:8},children:[1,2,3,4].map(function(r){var n=Z.filter(function(n){return n.classReq===e&&/_t\d+$/.test(n.id)&&n.id.endsWith("t".concat(r))});return 0===n.length?null:a.jsxs("div",{style:{display:"grid",gap:6},children:[a.jsx("div",{style:{opacity:.9,fontWeight:700},children:"Set ".concat(e," T").concat(r)}),n.map(function(e){var r,n,t,i,l,o,d,c,s=p("buy",Math.round(e.basePrice*g(e.rarity)),L),y=L.gold<s;return a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",borderRadius:12,background:"var(--panel-bg)",border:"1px solid rgba(255,255,255,0.08)"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.image?a.jsx("img",{src:e.image,alt:e.name,style:{width:36,height:36,objectFit:"cover",borderRadius:6}}):a.jsx("div",{style:{width:36,height:36,borderRadius:6,background:"rgba(255,255,255,0.07)"}}),a.jsxs("div",{children:[a.jsxs("div",{style:{fontWeight:700},children:[e.name," ",a.jsxs("span",{style:{color:x(e.rarity),fontSize:12,marginLeft:6},children:[null!==(r=null===(n=T.merchant)||void 0===n?void 0:n.rarity)&&void 0!==r?r:"Rarity",": ",e.rarity]})]}),a.jsxs("div",{style:{opacity:.85,fontSize:12},children:[null!==(t=null===(i=T.merchant)||void 0===i?void 0:i.price)&&void 0!==t?t:"Price",": ",s," ",e.requiredLevel?"• ".concat(null!==(l=null===(o=T.merchant)||void 0===o?void 0:o.reqLevel)&&void 0!==l?l:"Req Lv."," ").concat(e.requiredLevel,"+"):""]})]})]}),a.jsx(u,{onClick:function(){return X(e.id)},disabled:y,children:null!==(d=null===(c=T.merchant)||void 0===c?void 0:c.buy)&&void 0!==d?d:"Buy"})]},e.id)})]},"".concat(e,"_t").concat(r))})},e)})}),"weapons"===F&&a.jsx("div",{style:{display:"grid",gap:12,marginBottom:12},children:["warrior","volkhv","hunter"].map(function(e){return a.jsx("div",{style:{display:"grid",gap:8},children:[1,2,3,4].map(function(r){var n=re.filter(function(n){return n.classReq===e&&/_t\d+$/.test(n.id)&&n.id.endsWith("t".concat(r))});return 0===n.length?null:a.jsxs("div",{style:{display:"grid",gap:6},children:[a.jsx("div",{style:{opacity:.9,fontWeight:700},children:"Weapons ".concat(e," T").concat(r)}),n.map(function(e){var r=p("buy",Math.round(e.basePrice*g(e.rarity)),L),n=L.gold<r;return a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",borderRadius:12,background:"var(--panel-bg)",border:"1px solid rgba(255,255,255,0.08)"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.image?a.jsx("img",{src:e.image,alt:e.name,style:{width:36,height:36,objectFit:"cover",borderRadius:6}}):a.jsx("div",{style:{width:36,height:36,borderRadius:6,background:"rgba(255,255,255,0.07)"}}),a.jsxs("div",{children:[a.jsxs("div",{style:{fontWeight:700},children:[e.name," ",a.jsxs("span",{style:{color:x(e.rarity),fontSize:12,marginLeft:6},children:["Rarity: ",e.rarity]})]}),a.jsxs("div",{style:{opacity:.85,fontSize:12},children:["Price: ",r," ",e.requiredLevel?"• Req Lv. ".concat(e.requiredLevel,"+"):""]})]})]}),a.jsx(u,{onClick:function(){return X(e.id)},disabled:n,children:"Buy"})]},e.id)})]},"".concat(e,"_t").concat(r))})},e)})})]}),"sell"===E&&a.jsx("section",{style:{padding:12,borderRadius:16,background:"var(--panel-bg)",border:"var(--panel-border)"},children:a.jsxs("div",{style:{display:"grid",gap:8},children:[0===L.inventory.length&&a.jsx("div",{style:{opacity:.8},children:null!==(A=null===(B=T.merchant)||void 0===B?void 0:B.noItems)&&void 0!==A?A:"No items to sell."}),L.inventory.map(function(e,r){var n,i,l,o,s,y,v=G.get(e.id),f=v?m(v,L):10;return a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",borderRadius:12,background:"var(--panel-bg)",border:"1px solid rgba(255,255,255,0.08)"},children:[a.jsx("div",{style:{display:"flex",alignItems:"center",gap:10},children:a.jsxs("div",{children:[a.jsxs("div",{style:{fontWeight:700},children:[e.name," ",v?a.jsxs("span",{style:{color:x(v.rarity),fontSize:12,marginLeft:6},children:[null!==(n=null===(i=T.merchant)||void 0===i?void 0:i.rarity)&&void 0!==n?n:"Rarity",": ",v.rarity]}):null]}),a.jsxs("div",{style:{opacity:.85,fontSize:12},children:[null!==(l=null===(o=T.merchant)||void 0===o?void 0:o.sellFor)&&void 0!==l?l:"Sell for",": ",f]})]})}),a.jsx(u,{onClick:function(){return function(e){var r,n,i,l,o,a,s=L.inventory[e];if(s){var u=G.get(s.id),y=u?m(u,L):10,v=L.inventory.slice();v.splice(e,1);var f=t(t({},L),{},{gold:L.gold+y,inventory:v});d(f),z(f),c("quest",null!==(r=null===(n=T.merchant)||void 0===n?void 0:n.sale)&&void 0!==r?r:"Sale",{gold:y});var h=null===(i=window.Telegram)||void 0===i?void 0:i.WebApp;null==h||null===(l=h.sendData)||void 0===l||l.call(h,JSON.stringify({type:"sale",title:null!==(o=null!==(a=null==u?void 0:u.name)&&void 0!==a?a:s.name)&&void 0!==o?o:"Item",price:y,qty:1}))}}(r)},children:null!==(s=null===(y=T.merchant)||void 0===y?void 0:y.sell)&&void 0!==s?s:"Sell"})]},"".concat(e.id,"_").concat(r))})]})})]})});var n="mirevald:economy";function f(e){localStorage.setItem(n,JSON.stringify(e))}var h=function(e,r,n){return Math.max(r,Math.min(n,e))};function p(e,r,n){var t,i,l,o=null!==(t=n.karma)&&void 0!==t?t:0,a=null!==(i=n.luck)&&void 0!==i?i:0,d=null!==(l=n.sociality)&&void 0!==l?l:0,c=h(o,-30,30)/30,s=1-.12*c,u=1+.08*c,y=h(a,0,30)/30,v=1-.04*y,f=1+.03*y,p=-Math.min(.08,.01*Math.floor(d/5)),g=r*("buy"===e?s*v*(1+p):u*f)*(.02*Math.random()-.01+1);return Math.max(1,Math.round(g))}function g(e){return"common"===e?1:"uncommon"===e?1.2:"rare"===e?1.6:2.2}function m(e,r){var n;return p("sell",Math.round((null!==(n=e.sellBase)&&void 0!==n?n:.45*e.basePrice)*g(e.rarity)),r)}var b=function(){return"".concat((new Date).toISOString().slice(0,10),"-").concat("v2")};function j(e){var r,n,t,i,l,a=b(),d=function(){return Math.random()},c=null!==(r=null===(n=e.progress)||void 0===n?void 0:n.level)&&void 0!==r?r:1,s=[{t:1,lvl:1},{t:2,lvl:20},{t:3,lvl:40},{t:4,lvl:60}],u=null!==(t=[].concat(s).reverse().find(function(e){return c>=e.lvl}))&&void 0!==t?t:s[0],v=y.filter(function(r){return r.classReq===e.classId&&/_t\d+$/.test(r.id)&&r.id.endsWith("t".concat(u.t))}),f=[],h=function(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=o(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var t=0,i=function(){};return{s:i,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,a=!0,d=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){d=!0,l=e},f:function(){try{a||null==n.return||n.return()}finally{if(d)throw l}}}}(v);try{for(h.s();!(l=h.n()).done;){var m=l.value,j=g(m.rarity),x=p("buy",Math.round(m.basePrice*j),e);f.push({itemId:m.id,qty:1,price:x,rarity:m.rarity})}}catch(q){h.e(q)}finally{h.f()}for(var S=y.filter(function(e){return!f.find(function(r){return r.itemId===e.id})}),w=Math.min(30,Math.max(0,null!==(i=e.luck)&&void 0!==i?i:0)),k=.15+.01*w,M=.04+.004*w;f.length<8&&S.length;){var O=Math.floor(d()*S.length),I=S.splice(O,1)[0];if(!("rare"===I.rarity&&d()>k)&&!("epic"===I.rarity&&d()>M)){var R=g(I.rarity),P=p("buy",Math.round(I.basePrice*R),e);f.push({itemId:I.id,qty:1+Math.floor(2*d()),price:P,rarity:I.rarity})}}return{dateKey:a,offers:f}}function x(e){return"common"===e?"#9aa3ad":"uncommon"===e?"#3fb950":"rare"===e?"#539bf5":"#a371f7"}}}})}();
