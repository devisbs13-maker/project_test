import{r as l,l as L,j as a,d as R,b as o,f as A,g as M,h as W,i as B,k as N,a as F,o as G}from"./index-Ctau24pR.js";import{H}from"./Header-DF0lZ4nl.js";import{B as u}from"./Button-B-_t-Q2H.js";const J={leader:"Лидер",novice:"Новичок",warden:"Страж",seer:"Ясновидец"};function Z({player:d,onBack:w}){const[t,c]=l.useState(null),[h,n]=l.useState(!1),[p,r]=l.useState(null),[j,I]=l.useState(""),[b,S]=l.useState(""),[C,T]=l.useState(""),[x,m]=l.useState(""),[k,y]=l.useState([]),v=L(),f=(v==null?void 0:v.userId)||"local-user";async function i(){n(!0),r(null);try{const e=await F();if(e.ok)if(c(e.data),e.data){const s=await G();s.ok&&y(s.data.members||[])}else y([]);else r(e.error)}finally{n(!1)}}return l.useEffect(()=>{i()},[]),a.jsxs("div",{style:{display:"grid",gap:12,padding:16},children:[a.jsx(H,{title:"Клан",gold:d.gold,energy:d.energy,level:d.progress.level,onBack:w}),!t&&a.jsxs("section",{style:{display:"grid",gap:12,padding:12,borderRadius:16,background:"var(--panel-bg)",border:"var(--panel-border)"},children:[a.jsx("div",{style:{fontWeight:700},children:"Создать клан"}),a.jsxs("div",{style:{display:"grid",gap:8},children:[a.jsx("input",{placeholder:"Название",value:j,onChange:e=>I(e.target.value)}),a.jsx("input",{placeholder:"TAG (A-Z, 2-5)",value:b,onChange:e=>S(e.target.value.toUpperCase())}),a.jsx(u,{disabled:h||d.progress.level<5,onClick:async()=>{r(null),n(!0);try{const e=await R(j,b);e.ok?(c(e.data),o("Клан создан"),i()):(r(e.error||"Ошибка"),alert(e.error||"Не удалось создать клан"))}finally{n(!1)}},children:d.progress.level<5?"Требуется 5 уровень":"Создать"})]}),a.jsx("div",{style:{marginTop:8,fontWeight:700},children:"Вступить в клан"}),a.jsxs("div",{style:{display:"grid",gap:8},children:[a.jsx("input",{placeholder:"TAG",value:C,onChange:e=>T(e.target.value.toUpperCase())}),a.jsx(u,{disabled:h,onClick:async()=>{r(null),n(!0);try{const e=await A(C);e.ok?(c(e.data),o("Вы вступили в клан"),i()):(r(e.error||"Ошибка"),alert(e.error||"Не удалось вступить"))}finally{n(!1)}},children:"Вступить"})]}),p&&a.jsx("div",{style:{color:"#e77"},children:p})]}),t&&a.jsxs("section",{style:{display:"grid",gap:12,padding:12,borderRadius:16,background:"var(--panel-bg)",border:"var(--panel-border)"},children:[a.jsxs("div",{style:{fontWeight:700},children:[t.name," [",t.tag,"]"]}),a.jsxs("div",{children:["Банк: ",t.bank]}),a.jsx("div",{style:{opacity:.85},children:"Бонус к прогрессу: +10% за вклад клана"}),a.jsx("div",{style:{marginTop:8,fontWeight:700},children:"Участники"}),a.jsx("div",{style:{display:"grid",gap:6},children:k.map(e=>{var s;return a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 10px",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10},children:[a.jsxs("div",{children:[a.jsx("b",{children:e.userId===f?"Вы":e.name||e.userId})," ",a.jsx("span",{style:{opacity:.8,marginLeft:8},children:J[e.role]})]}),a.jsx("div",{style:{display:"flex",gap:6},children:((s=k.find(g=>g.userId===f))==null?void 0:s.role)==="leader"&&e.userId!==f&&a.jsxs(a.Fragment,{children:[a.jsxs("select",{onChange:async g=>{const E=g.target.value;(await M(e.userId,E)).ok&&(o("Роль обновлена"),i())},defaultValue:e.role,style:{background:"var(--panel-bg)",color:"var(--text)"},children:[a.jsx("option",{value:"novice",children:"Новичок"}),a.jsx("option",{value:"warden",children:"Страж"}),a.jsx("option",{value:"seer",children:"Ясновидец"}),a.jsx("option",{value:"leader",children:"Лидер"})]}),a.jsx(u,{onClick:async()=>{(await W(e.userId)).ok&&(o("Исключён"),i())},children:"Выгнать"})]})})]},e.userId)})}),a.jsxs("div",{style:{display:"flex",gap:8},children:[a.jsx("input",{type:"number",placeholder:"Сумма вклада",value:x,onChange:e=>m(e.target.value)}),a.jsx(u,{disabled:h||!x,onClick:async()=>{const e=Number(x);if(!Number.isFinite(e)||e<=0){r("Сумма должна быть > 0"),alert("Сумма должна быть больше 0");return}r(null),n(!0);try{const s=await B(e);s.ok?(c({...t,bank:s.data.bank}),m(""),o("Вклад принят!")):(r(s.error||"Ошибка"),alert(s.error||"Не удалось внести вклад"))}finally{n(!1)}},children:"Внести"}),a.jsx(u,{onClick:async()=>{(await N()).ok&&(o("Вы покинули клан"),c(null),y([]),i())},children:"Покинуть"})]}),p&&a.jsx("div",{style:{color:"#e77"},children:p})]})]})}export{Z as default};
