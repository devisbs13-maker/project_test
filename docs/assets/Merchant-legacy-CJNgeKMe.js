!function(){function e(r){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(r)}function r(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||o(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function n(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?t(Object(n),!0).forEach(function(r){i(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function i(r,t,n){return(t=function(r){var t=function(r,t){if("object"!=e(r)||!r)return r;var n=r[Symbol.toPrimitive];if(void 0!==n){var i=n.call(r,t||"default");if("object"!=e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(r)}(r,"string");return"symbol"==e(t)?t:t+""}(t))in r?Object.defineProperty(r,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[t]=n,r}function a(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var n,i,a,o,l=[],s=!0,c=!1;try{if(a=(t=t.call(e)).next,0===r){if(Object(t)!==t)return;s=!1}else for(;!(s=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);s=!0);}catch(e){c=!0,i=e}finally{try{if(!s&&null!=t.return&&(o=t.return(),Object(o)!==o))return}finally{if(c)throw i}}return l}}(e,r)||o(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,r){if(e){if("string"==typeof e)return l(e,r);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?l(e,r):void 0}}function l(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=Array(r);t<r;t++)n[t]=e[t];return n}System.register(["./index-legacy-C54gzF4w.js","./Header-legacy-tXmvuVNU.js","./Button-legacy-DeRXUO5G.js","./catalog-legacy-B8sB8at-.js"],function(e,t){"use strict";var i,l,s,c,d,u,y;return{setters:[function(e){i=e.r,l=e.j,s=e.s,c=e.n},function(e){d=e.H},function(e){u=e.B},function(e){y=e.C}],execute:function(){e("default",function(e){var o=e.player,v=e.onBack,x=e.onUpdatePlayer,S=a(i.useState("buy"),2),w=S[0],k=S[1],M=a(i.useState("resources"),2),O=M[0],I=M[1],R=a(i.useState("all"),2),P=(R[0],R[1],a(i.useState(function(){var e=function(){try{var e=localStorage.getItem(t);return e?JSON.parse(e):null}catch(r){return null}}();if(!e||e.dateKey!==b()){var r=m(o);return f(r),r}return e}),2)),q=P[0],C=P[1],A=i.useMemo(function(){return new Map(y.map(function(e){return[e.id,e]}))},[]);try{var B=q.offers.filter(function(e){return A.has(e.itemId)});if(q.offers.length>0&&0===B.length){var W=m(o);f(W),C(W)}}catch(N){}function L(e){var t=A.get(e);if(t){var i=p("buy",Math.round(t.basePrice*g(t.rarity)),o);if(!(o.gold<i)){var a={id:t.id,name:t.name,slot:t.slot,rarity:t.rarity,requiredLevel:t.requiredLevel,classReq:t.classReq},l=n(n({},o),{},{gold:o.gold-i,inventory:[].concat(r(o.inventory),[a])});s(l),x(l);try{var d,u;c("quest","Purchase",{gold:-i});var y=null===(d=window.Telegram)||void 0===d?void 0:d.WebApp;null==y||null===(u=y.sendData)||void 0===u||u.call(y,JSON.stringify({type:"purchase",title:t.name,price:i,qty:1}))}catch(f){}}}}var z=new Set(["helmet","chest","pants","boots","gloves","weapon"]),T=i.useMemo(function(){return y.filter(function(e){return z.has(e.slot)&&"weapon"!==e.slot})},[]),D=i.useMemo(function(){return y.filter(function(e){return"misc"===e.slot})},[]),E=i.useMemo(function(){return y.filter(function(e){return"weapon"===e.slot})},[]);return l.jsxs("div",{style:{display:"grid",gap:12,padding:16},children:[l.jsx(d,{title:"Merchant",gold:o.gold,energy:o.energy,level:o.progress.level,onBack:v}),l.jsxs("div",{style:{display:"flex",gap:8},children:[l.jsx(u,{onClick:function(){return k("buy")},disabled:"buy"===w,children:"Buy"}),l.jsx(u,{onClick:function(){return k("sell")},disabled:"sell"===w,children:"Sell"})]}),"buy"===w&&l.jsxs("section",{style:{padding:12,borderRadius:16,background:"var(--panel-bg)",border:"var(--panel-border)"},children:[l.jsxs("div",{style:{display:"flex",gap:8,marginBottom:8},children:[l.jsx(u,{onClick:function(){return I("resources")},disabled:"resources"===O,children:"Resources"}),l.jsx(u,{onClick:function(){return I("clothing")},disabled:"clothing"===O,children:"Armor"})]}),l.jsx("div",{style:{display:"flex",gap:8,marginBottom:8},children:l.jsx(u,{onClick:function(){return I("weapons")},disabled:"weapons"===O,children:"Weapons"})}),"resources"===O&&l.jsx("div",{style:{display:"grid",gap:8,marginBottom:12},children:D.map(function(e){var r=p("buy",Math.round(e.basePrice*g(e.rarity)),o),t=o.gold<r;return l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 12px",borderRadius:12,background:"var(--panel-bg)",border:"1px solid rgba(255,255,255,0.08)"},children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.image?l.jsx("img",{src:e.image,alt:e.name,style:{width:32,height:32,objectFit:"cover",borderRadius:6}}):l.jsx("div",{style:{width:32,height:32,borderRadius:6,background:"rgba(255,255,255,0.07)"}}),l.jsxs("div",{children:[l.jsxs("div",{style:{fontWeight:700},children:[e.name," ",l.jsxs("span",{style:{color:j(e.rarity),fontSize:12,marginLeft:6},children:["Rarity: ",e.rarity]})]}),l.jsxs("div",{style:{opacity:.85,fontSize:12},children:["Price: ",r]})]})]}),l.jsx(u,{onClick:function(){return L(e.id)},disabled:t,children:"Buy"})]},e.id)})}),"clothing"===O&&l.jsx("div",{style:{display:"grid",gap:12,marginBottom:12},children:["warrior","volkhv","hunter"].map(function(e){return l.jsx("div",{style:{display:"grid",gap:8},children:[1,2,3,4].map(function(r){var t=T.filter(function(t){return t.classReq===e&&/_t\d+$/.test(t.id)&&t.id.endsWith("t".concat(r))});return 0===t.length?null:l.jsxs("div",{style:{display:"grid",gap:6},children:[l.jsx("div",{style:{opacity:.9,fontWeight:700},children:"Set ".concat(e," T").concat(r)}),t.map(function(e){var r=p("buy",Math.round(e.basePrice*g(e.rarity)),o),t=o.gold<r;return l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",borderRadius:12,background:"var(--panel-bg)",border:"1px solid rgba(255,255,255,0.08)"},children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.image?l.jsx("img",{src:e.image,alt:e.name,style:{width:36,height:36,objectFit:"cover",borderRadius:6}}):l.jsx("div",{style:{width:36,height:36,borderRadius:6,background:"rgba(255,255,255,0.07)"}}),l.jsxs("div",{children:[l.jsxs("div",{style:{fontWeight:700},children:[e.name," ",l.jsxs("span",{style:{color:j(e.rarity),fontSize:12,marginLeft:6},children:["Rarity: ",e.rarity]})]}),l.jsxs("div",{style:{opacity:.85,fontSize:12},children:["Price: ",r," ",e.requiredLevel?"• Req Lv. ".concat(e.requiredLevel,"+"):""]})]})]}),l.jsx(u,{onClick:function(){return L(e.id)},disabled:t,children:"Buy"})]},e.id)})]},"".concat(e,"_t").concat(r))})},e)})}),"weapons"===O&&l.jsx("div",{style:{display:"grid",gap:12,marginBottom:12},children:["warrior","volkhv","hunter"].map(function(e){return l.jsx("div",{style:{display:"grid",gap:8},children:[1,2,3,4].map(function(r){var t=E.filter(function(t){return t.classReq===e&&/_t\d+$/.test(t.id)&&t.id.endsWith("t".concat(r))});return 0===t.length?null:l.jsxs("div",{style:{display:"grid",gap:6},children:[l.jsx("div",{style:{opacity:.9,fontWeight:700},children:"Weapons ".concat(e," T").concat(r)}),t.map(function(e){var r=p("buy",Math.round(e.basePrice*g(e.rarity)),o),t=o.gold<r;return l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",borderRadius:12,background:"var(--panel-bg)",border:"1px solid rgba(255,255,255,0.08)"},children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.image?l.jsx("img",{src:e.image,alt:e.name,style:{width:36,height:36,objectFit:"cover",borderRadius:6}}):l.jsx("div",{style:{width:36,height:36,borderRadius:6,background:"rgba(255,255,255,0.07)"}}),l.jsxs("div",{children:[l.jsxs("div",{style:{fontWeight:700},children:[e.name," ",l.jsxs("span",{style:{color:j(e.rarity),fontSize:12,marginLeft:6},children:["Rarity: ",e.rarity]})]}),l.jsxs("div",{style:{opacity:.85,fontSize:12},children:["Price: ",r," ",e.requiredLevel?"• Req Lv. ".concat(e.requiredLevel,"+"):""]})]})]}),l.jsx(u,{onClick:function(){return L(e.id)},disabled:t,children:"Buy"})]},e.id)})]},"".concat(e,"_t").concat(r))})},e)})})]}),"sell"===w&&l.jsx("section",{style:{padding:12,borderRadius:16,background:"var(--panel-bg)",border:"var(--panel-border)"},children:l.jsxs("div",{style:{display:"grid",gap:8},children:[0===o.inventory.length&&l.jsx("div",{style:{opacity:.8},children:"No items to sell."}),o.inventory.map(function(e,r){var t=A.get(e.id),i=t?h(t,o):10;return l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",borderRadius:12,background:"var(--panel-bg)",border:"1px solid rgba(255,255,255,0.08)"},children:[l.jsx("div",{style:{display:"flex",alignItems:"center",gap:10},children:l.jsxs("div",{children:[l.jsxs("div",{style:{fontWeight:700},children:[e.name," ",t?l.jsxs("span",{style:{color:j(t.rarity),fontSize:12,marginLeft:6},children:["Rarity: ",t.rarity]}):null]}),l.jsxs("div",{style:{opacity:.85,fontSize:12},children:["Sell for: ",i]})]})}),l.jsx(u,{onClick:function(){return function(e){var r,t,i,a,l=o.inventory[e];if(l){var d=A.get(l.id),u=d?h(d,o):10,y=o.inventory.slice();y.splice(e,1);var f=n(n({},o),{},{gold:o.gold+u,inventory:y});s(f),x(f),c("quest","Sale",{gold:u});var v=null===(r=window.Telegram)||void 0===r?void 0:r.WebApp;null==v||null===(t=v.sendData)||void 0===t||t.call(v,JSON.stringify({type:"sale",title:null!==(i=null!==(a=null==d?void 0:d.name)&&void 0!==a?a:l.name)&&void 0!==i?i:"Item",price:u,qty:1}))}}(r)},children:"Sell"})]},"".concat(e.id,"_").concat(r))})]})})]})});var t="mirevald:economy";function f(e){localStorage.setItem(t,JSON.stringify(e))}var v=function(e,r,t){return Math.max(r,Math.min(t,e))};function p(e,r,t){var n,i,a,o=null!==(n=t.karma)&&void 0!==n?n:0,l=null!==(i=t.luck)&&void 0!==i?i:0,s=null!==(a=t.sociality)&&void 0!==a?a:0,c=v(o,-30,30)/30,d=1-.12*c,u=1+.08*c,y=v(l,0,30)/30,f=1-.04*y,p=1+.03*y,g=-Math.min(.08,.01*Math.floor(s/5)),h=r*("buy"===e?d*f*(1+g):u*p)*(.02*Math.random()-.01+1);return Math.max(1,Math.round(h))}function g(e){return"common"===e?1:"uncommon"===e?1.2:"rare"===e?1.6:2.2}function h(e,r){var t;return p("sell",Math.round((null!==(t=e.sellBase)&&void 0!==t?t:.45*e.basePrice)*g(e.rarity)),r)}var b=function(){return"".concat((new Date).toISOString().slice(0,10),"-").concat("v2")};function m(e){var r,t,n,i,a,l=b(),s=function(){return Math.random()},c=null!==(r=null===(t=e.progress)||void 0===t?void 0:t.level)&&void 0!==r?r:1,d=[{t:1,lvl:1},{t:2,lvl:20},{t:3,lvl:40},{t:4,lvl:60}],u=null!==(n=[].concat(d).reverse().find(function(e){return c>=e.lvl}))&&void 0!==n?n:d[0],f=y.filter(function(r){return r.classReq===e.classId&&/_t\d+$/.test(r.id)&&r.id.endsWith("t".concat(u.t))}),v=[],h=function(e,r){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=o(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,l=!0,s=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return l=e.done,e},e:function(e){s=!0,a=e},f:function(){try{l||null==t.return||t.return()}finally{if(s)throw a}}}}(f);try{for(h.s();!(a=h.n()).done;){var m=a.value,j=g(m.rarity),x=p("buy",Math.round(m.basePrice*j),e);v.push({itemId:m.id,qty:1,price:x,rarity:m.rarity})}}catch(q){h.e(q)}finally{h.f()}for(var S=y.filter(function(e){return!v.find(function(r){return r.itemId===e.id})}),w=Math.min(30,Math.max(0,null!==(i=e.luck)&&void 0!==i?i:0)),k=.15+.01*w,M=.04+.004*w;v.length<8&&S.length;){var O=Math.floor(s()*S.length),I=S.splice(O,1)[0];if(!("rare"===I.rarity&&s()>k)&&!("epic"===I.rarity&&s()>M)){var R=g(I.rarity),P=p("buy",Math.round(I.basePrice*R),e);v.push({itemId:I.id,qty:1+Math.floor(2*s()),price:P,rarity:I.rarity})}}return{dateKey:l,offers:v}}function j(e){return"common"===e?"#9aa3ad":"uncommon"===e?"#3fb950":"rare"===e?"#539bf5":"#a371f7"}}}})}();
