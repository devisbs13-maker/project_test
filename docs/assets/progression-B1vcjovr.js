import{r as m,j as w,c as v,s as S}from"./index-iM7eXiqC.js";import{r as M,f as x,n as g,s as j}from"./time-WGOIUK2d.js";function T({endsAt:t}){const[a,e]=m.useState(M(t));return m.useEffect(()=>{const r=setInterval(()=>e(M(t)),1e3);return()=>clearInterval(r)},[t]),w.jsxs("span",{style:{padding:"4px 8px",borderRadius:10,border:"1px solid rgba(255,255,255,0.1)",background:"var(--panel-bg)"},children:["Осталось: ",x(a)]})}const p="mirevald:game";function u(t=100){const a=[],e=[1];for(let r=5;r<=t;r+=5)e.push(r);return e.forEach((r,s)=>{const n=s+1,l=60*(3+Math.min(10,Math.floor(n*.75))),o=60*(5+Math.min(20,Math.floor(n))),i=2+Math.floor(n/5),d=2+Math.floor(n/4),h=15+Math.round(r*2),y=10+Math.round(r*1.2),f=40+r*6;a.push({id:"q-".concat(r),kind:"quest",title:"Задание уровня ".concat(r),desc:"Испытание для героев ур. ≥ ".concat(r),durationSec:l,costEnergy:i,reward:{xp:h,gold:Math.round(f*.5)},requiredLevel:r}),a.push({id:"j-".concat(r),kind:"job",title:"Работа уровня ".concat(r),desc:"Подходит для ур. ≥ ".concat(r),durationSec:o,costEnergy:d,reward:{gold:Math.round(f),xp:y},requiredLevel:r})}),a}function k(){var t;try{const a=localStorage.getItem(p);if(!a)return{tasks:u(100),active:[],vault:[],limits:{quest:1,job:2}};const e=JSON.parse(a);return{tasks:u(100),active:Array.isArray(e.active)?e.active:[],vault:Array.isArray(e.vault)?e.vault:[],limits:(t=e.limits)!=null?t:{quest:1,job:2}}}catch(a){return{tasks:u(100),active:[],vault:[],limits:{quest:1,job:2}}}}function A(t){localStorage.setItem(p,JSON.stringify(t))}const O=[{id:"m1",name:"Дикий кабан",diffMul:.6,rewardMul:.7},{id:"m2",name:"Гоблин-разбойник",diffMul:.75,rewardMul:.85},{id:"m3",name:"Волк-альфа",diffMul:.9,rewardMul:1},{id:"m4",name:"Отшельник-маг",diffMul:1,rewardMul:1.1},{id:"m5",name:"Гнолл-воин",diffMul:1.1,rewardMul:1.25},{id:"m6",name:"Тролль-бродяга",diffMul:1.2,rewardMul:1.35},{id:"m7",name:"Огр-громила",diffMul:1.35,rewardMul:1.5},{id:"m8",name:"Дух леса",diffMul:1.5,rewardMul:1.65},{id:"m9",name:"Дракончик",diffMul:1.65,rewardMul:1.8},{id:"m10",name:"Древний ужас",diffMul:1.8,rewardMul:2}],c="mirevald:battle";function R(){try{const t=localStorage.getItem(c);return t?JSON.parse(t):null}catch(t){return null}}function q(t){if(!t){try{localStorage.removeItem(c)}catch(a){}return}localStorage.setItem(c,JSON.stringify(t))}function $(t){return!t||!t.active?!1:t.endsAt>g()}function E(t){return 40+t*8}function B(t,a){var i,d;const e=g(),r=j(30*60),s=Math.floor(Math.random()*1e9),n=(d=(i=t.progress)==null?void 0:i.level)!=null?d:1,l=Math.round(E(n)*a.diffMul),o={active:!0,startedAt:e,endsAt:e+r,seed:s,monster:a.name,monsterId:a.id,difficulty:l,rewardMul:a.rewardMul};return q(o),o}function N(t,a){let e={...t};if(a.gold&&(e.gold+=a.gold,e.goldTotal=e.goldTotal?e.goldTotal+a.gold:a.gold),a.xp){let r=a.xp;try{localStorage.getItem("mirevald:clan")&&(r=Math.round(r*1.1))}catch(s){}e=v(e,r)}return a.energy&&(e.energy=Math.min(e.energyMax,e.energy+a.energy)),S(e),e}export{O as M,T,R as a,B as b,q as c,N as g,$ as i,k as l,A as s};
