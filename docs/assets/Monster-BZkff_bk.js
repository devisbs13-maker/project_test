import{r as p,e as H,j as e,n as z,b as B,s as G}from"./index-KSIM0t-z.js";import{H as N}from"./Header-Bx5OPXMv.js";import{B as q}from"./Button-DO4FSLJV.js";import{a as I,i as O,M as P,T as V,l as _,b as J,c as K,g as Q}from"./progression-CASIVs7m.js";import{r as M}from"./time-WGOIUK2d.js";import{C as U}from"./catalog-z_q2Z5IU.js";function X(s){const l=Math.max(0,Math.floor(s/1e3)),f=Math.floor(l/60).toString().padStart(2,"0"),a=(l%60).toString().padStart(2,"0");return"".concat(f,":").concat(a)}function nt({player:s,onBack:l,onUpdatePlayer:f}){const[a,g]=p.useState(()=>I()),u=O(a),C=a?M(a.endsAt):0,d=p.useMemo(()=>{const t=H(s);return t.str+t.agi+t.int+t.vit+s.progress.level*2},[s]);p.useEffect(()=>{const t=setInterval(()=>g(I()),1e3);return()=>clearInterval(t)},[]);function T(t){if(u)return;try{if((_().active||[]).length>0){alert("Finish other activities first (quests/jobs).");return}}catch(i){}const r=J(s,t);g(r)}function W(){var c,y,b;if(!a||M(a.endsAt)>0)return;const t=a.difficulty,r=.5+(d-t)/100,i=Math.max(.05,Math.min(.95,r)),m=Math.random()<i;if(K(null),g(null),m){const h=s.progress.level,j=d-t,w=Math.max(.7,Math.min(1.5,1+j/120)),R=(c=a.rewardMul)!=null?c:1,k=.9+Math.random()*.2,S=Math.max(5,Math.round((30+h*6)*w*R*k)),A=Math.max(5,Math.round((18+h*3)*w*R*k));let o=Q(s,{gold:S,xp:A});const E=Math.max(0,Math.min(30,(y=s.luck)!=null?y:0)),L=Math.max(.08,Math.min(.5,.18+E*.008+Math.max(0,j)*.003));if(Math.random()<L){const v=[{t:1,lvl:1},{t:2,lvl:20},{t:3,lvl:40},{t:4,lvl:60}],$=(b=[...v].reverse().find(n=>h>=n.lvl))!=null?b:v[0],D=s.classId,x=U.filter(n=>n.classReq===D&&/_t\d+$/.test(n.id)&&n.id.endsWith("t".concat($.t)));if(x.length>0){const n=x[Math.floor(Math.random()*x.length)],F={id:n.id,name:n.name,slot:n.slot,rarity:n.rarity,requiredLevel:n.requiredLevel,classReq:n.classReq};o={...o,inventory:[...o.inventory,F]}}}z("quest","Monster defeated",{gold:S,xp:A});try{B("Victory! Rewards granted.")}catch(v){}G(o),f(o)}else try{B("Defeat. Try a weaker monster.")}catch(h){}}return e.jsxs("div",{style:{display:"grid",gap:12,padding:16},children:[e.jsx(N,{title:"Monster Hunt",gold:s.gold,energy:s.energy,level:s.progress.level,onBack:l}),!u&&e.jsx("section",{style:{padding:12,borderRadius:16,background:"var(--panel-bg)",border:"var(--panel-border)"},children:e.jsx("div",{style:{display:"grid",gap:8},children:e.jsx("div",{style:{display:"grid",gap:8},children:[...P].sort((t,r)=>t.diffMul-r.diffMul).map(t=>{const r=s.progress.level,i=Math.round((40+r*8)*t.diffMul),m=.5+(d-i)/100,c=Math.max(.05,Math.min(.95,m));return e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",borderRadius:12,background:"var(--panel-bg)",border:"1px solid rgba(255,255,255,0.08)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[t.image?e.jsx("img",{src:t.image,alt:t.name,style:{width:40,height:40,objectFit:"cover",borderRadius:8}}):e.jsx("div",{style:{width:40,height:40,borderRadius:8,background:"rgba(255,255,255,0.07)"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:700},children:t.name}),e.jsxs("div",{style:{opacity:.85,fontSize:12},children:["Difficulty: ",i," · Win chance: ",Math.round(c*100),"% · Reward x",t.rewardMul]})]})]}),e.jsx(q,{onClick:()=>T(t),children:"Fight"})]},t.id)})})})}),u&&a&&e.jsx("section",{style:{padding:12,borderRadius:16,background:"var(--panel-bg)",border:"var(--panel-border)"},children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontWeight:700},children:a.monster}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(V,{endsAt:a.endsAt}),e.jsx("span",{style:{opacity:.85},children:X(C)})]}),e.jsxs("div",{style:{opacity:.85,fontSize:12},children:["Power: ",d," · Difficulty: ",a.difficulty]}),e.jsx(q,{disabled:M(a.endsAt)>0,onClick:W,children:"Resolve Battle"})]})})]})}export{nt as default};
