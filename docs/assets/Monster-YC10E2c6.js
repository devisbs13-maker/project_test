import{r as A,e as tt,j as e,n as et,b as N,s as st}from"./index-By2cNAY-.js";import{H as rt}from"./Header-CHg887X4.js";import{B as P}from"./Button-B4YQqtbm.js";import{a as V,i as nt,M as it,T as at,l as ot,b as lt,c as dt,g as ct}from"./progression-1UR0A9pq.js";import{r as B}from"./time-WGOIUK2d.js";import{C as ht}from"./catalog-z_q2Z5IU.js";import{g as ft}from"./index-FU-_DbfN.js";import"./ru-DqIjrUCB.js";function mt(s){const M=Math.max(0,Math.floor(s/1e3)),j=Math.floor(M/60).toString().padStart(2,"0"),r=(M%60).toString().padStart(2,"0");return"".concat(j,":").concat(r)}function jt({player:s,onBack:M,onUpdatePlayer:j}){var T,q,C,I,W,E,L,$;const r=ft(),[n,w]=A.useState(()=>V()),R=nt(n),_=n?B(n.endsAt):0,y=A.useMemo(()=>{const t=tt(s);return t.str+t.agi+t.int+t.vit+s.progress.level*2},[s]);A.useEffect(()=>{const t=setInterval(()=>w(V()),1e3);return()=>clearInterval(t)},[]);function J(t){var o,l;if(R)return;try{if((ot().active||[]).length>0){alert((l=(o=r.monster)==null?void 0:o.finishOthers)!=null?l:"Finish other activities first (quests/jobs).");return}}catch(d){}const a=lt(s,t);w(a)}function K(){var d,c,h,f,m,g,u,v,p;if(!n||B(n.endsAt)>0)return;const t=n.difficulty,a=.5+(y-t)/100,o=Math.max(.05,Math.min(.95,a)),l=Math.random()<o;if(dt(null),w(null),l){const b=s.progress.level,D=y-t,F=Math.max(.7,Math.min(1.5,1+D/120)),H=(d=n.rewardMul)!=null?d:1,O=.9+Math.random()*.2,z=Math.max(5,Math.round((30+b*6)*F*H*O)),G=Math.max(5,Math.round((18+b*3)*F*H*O));let x=ct(s,{gold:z,xp:G});const Q=Math.max(0,Math.min(30,(c=s.luck)!=null?c:0)),U=Math.max(.08,Math.min(.5,.18+Q*.008+Math.max(0,D)*.003));if(Math.random()<U){const k=[{t:1,lvl:1},{t:2,lvl:20},{t:3,lvl:40},{t:4,lvl:60}],X=(h=[...k].reverse().find(i=>b>=i.lvl))!=null?h:k[0],Y=s.classId,S=ht.filter(i=>i.classReq===Y&&/_t\d+$/.test(i.id)&&i.id.endsWith("t".concat(X.t)));if(S.length>0){const i=S[Math.floor(Math.random()*S.length)],Z={id:i.id,name:i.name,slot:i.slot,rarity:i.rarity,requiredLevel:i.requiredLevel,classReq:i.classReq};x={...x,inventory:[...x.inventory,Z]}}}et("quest",(m=(f=r.monster)==null?void 0:f.defeated)!=null?m:"Monster defeated",{gold:z,xp:G});try{N((u=(g=r.monster)==null?void 0:g.victory)!=null?u:"Victory! Rewards granted.")}catch(k){}st(x),j(x)}else try{N((p=(v=r.monster)==null?void 0:v.defeat)!=null?p:"Defeat. Try a weaker monster.")}catch(b){}}return e.jsxs("div",{style:{display:"grid",gap:12,padding:16},children:[e.jsx(rt,{title:(q=(T=r.buttons)==null?void 0:T.monster)!=null?q:"Monster Hunt",gold:s.gold,energy:s.energy,level:s.progress.level,onBack:M}),!R&&e.jsx("section",{style:{padding:12,borderRadius:16,background:"var(--panel-bg)",border:"var(--panel-border)"},children:e.jsx("div",{style:{display:"grid",gap:8},children:e.jsx("div",{style:{display:"grid",gap:8},children:[...it].sort((t,a)=>t.diffMul-a.diffMul).map(t=>{var c,h,f,m,g,u,v,p;const a=s.progress.level,o=Math.round((40+a*8)*t.diffMul),l=.5+(y-o)/100,d=Math.max(.05,Math.min(.95,l));return e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",borderRadius:12,background:"var(--panel-bg)",border:"1px solid rgba(255,255,255,0.08)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[t.image?e.jsx("img",{src:t.image,alt:t.name,style:{width:40,height:40,objectFit:"cover",borderRadius:8}}):e.jsx("div",{style:{width:40,height:40,borderRadius:8,background:"rgba(255,255,255,0.07)"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:700},children:t.name}),e.jsxs("div",{style:{opacity:.85,fontSize:12},children:[(h=(c=r.monster)==null?void 0:c.difficulty)!=null?h:"Difficulty",": ",o," • ",(m=(f=r.monster)==null?void 0:f.winChance)!=null?m:"Win chance",": ",Math.round(d*100),"% • ",(u=(g=r.monster)==null?void 0:g.reward)!=null?u:"Reward"," x",t.rewardMul]})]})]}),e.jsx(P,{onClick:()=>J(t),children:(p=(v=r.monster)==null?void 0:v.fight)!=null?p:"Fight"})]},t.id)})})})}),R&&n&&e.jsx("section",{style:{padding:12,borderRadius:16,background:"var(--panel-bg)",border:"var(--panel-border)"},children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontWeight:700},children:n.monster}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(at,{endsAt:n.endsAt}),e.jsx("span",{style:{opacity:.85},children:mt(_)})]}),e.jsxs("div",{style:{opacity:.85,fontSize:12},children:[(I=(C=r.monster)==null?void 0:C.power)!=null?I:"Power",": ",y," • ",(E=(W=r.monster)==null?void 0:W.difficulty)!=null?E:"Difficulty",": ",n.difficulty]}),e.jsx(P,{disabled:B(n.endsAt)>0,onClick:K,children:($=(L=r.monster)==null?void 0:L.resolve)!=null?$:"Resolve Battle"})]})})]})}export{jt as default};
