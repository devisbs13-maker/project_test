import{r as p,j as e,q as S,t as B,v as E,w as H}from"./index-C9bto1Tn.js";import{H as T}from"./Header-ekbZHO_x.js";import{B as g}from"./Button-CS4s1xVY.js";function G({player:a,onBack:l}){var b,y,j,v,k;const[r,o]=p.useState(""),[c,I]=p.useState(""),[s,f]=p.useState(null),x=p.useMemo(()=>{var m,C,D;if(!((m=s==null?void 0:s.data)!=null&&m.state))return!1;const i=s.data.state,d=i.current==="A",u=(C=i.a)==null?void 0:C.id,t=(D=i.b)==null?void 0:D.id;return(d?u:t)===a.id||(d?u:t)===void 0},[s,a]);p.useEffect(()=>{if(!r)return;let i=!1;const d=async()=>{var u;try{const t=await S(r);!i&&(t!=null&&t.ok)&&f(t)}catch(t){}!i&&((u=s==null?void 0:s.data)==null?void 0:u.status)!=="finished"&&setTimeout(d,1500)};return d(),()=>{i=!0}},[r]);async function w(){const i=await B();i!=null&&i.ok&&i.id&&o(i.id)}async function R(){if(!c)return;const i=await E(c.trim());i!=null&&i.ok&&i.id&&o(i.id)}async function h(i){if(!r)return;const d=await H(r,i);d!=null&&d.ok&&f(d)}const n=((b=s==null?void 0:s.data)==null?void 0:b.state)||null;return e.jsxs("div",{style:{display:"grid",gap:12,padding:16},children:[e.jsx(T,{title:"PvP Duel",gold:a.gold,energy:a.energy,level:a.progress.level,onBack:l}),!r&&e.jsx("section",{style:{padding:12,borderRadius:16,background:"var(--panel-bg)",border:"var(--panel-border)",display:"grid",gap:8},children:e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(g,{onClick:w,children:"Create Challenge"}),e.jsx("input",{value:c,onChange:i=>I(i.target.value),placeholder:"Enter duel id",style:{flex:1,padding:"8px 10px",borderRadius:10,background:"transparent",border:"1px solid rgba(255,255,255,0.15)",color:"inherit"}}),e.jsx(g,{onClick:R,disabled:!c,children:"Accept"})]})}),r&&e.jsxs("section",{style:{padding:12,borderRadius:16,background:"var(--panel-bg)",border:"var(--panel-border)",display:"grid",gap:10},children:[e.jsxs("div",{style:{opacity:.9},children:["Duel ID: ",e.jsx("code",{children:r})]}),e.jsxs("div",{style:{display:"flex",gap:12},children:[e.jsx(A,{label:"A",data:n==null?void 0:n.a,active:(n==null?void 0:n.current)==="A"}),e.jsx(A,{label:"B",data:n==null?void 0:n.b,active:(n==null?void 0:n.current)==="B"})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(g,{onClick:()=>h("attack"),disabled:!x||((y=s==null?void 0:s.data)==null?void 0:y.status)==="finished",children:"Attack"}),e.jsx(g,{onClick:()=>h("defend"),disabled:!x||((j=s==null?void 0:s.data)==null?void 0:j.status)==="finished",children:"Defend"}),e.jsx(g,{onClick:()=>h("skill"),disabled:!x||((v=s==null?void 0:s.data)==null?void 0:v.status)==="finished",children:"Skill"})]}),e.jsxs("div",{style:{padding:10,borderRadius:10,background:"rgba(255,255,255,0.04)"},children:[e.jsx("b",{children:"Log"}),e.jsx("div",{style:{display:"grid",gap:4,marginTop:6},children:((n==null?void 0:n.log)||[]).slice().reverse().map((i,d)=>e.jsx("div",{style:{opacity:.9},children:i},d))})]}),((k=s==null?void 0:s.data)==null?void 0:k.status)==="finished"&&e.jsx("div",{style:{fontWeight:700},children:"Finished"})]})]})}function A({label:a,data:l,active:r}){var o,c;return e.jsxs("div",{style:{flex:1,padding:10,borderRadius:12,border:"1px solid rgba(255,255,255,0.1)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs("b",{children:[a,": ",(l==null?void 0:l.name)||"-"]}),r&&e.jsx("span",{style:{opacity:.8},children:"Your turn"})]}),e.jsxs("div",{style:{marginTop:6},children:["HP: ",(o=l==null?void 0:l.hp)!=null?o:0,"/",(c=l==null?void 0:l.maxHp)!=null?c:0]})]})}export{G as default};
