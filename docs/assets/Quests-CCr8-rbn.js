import{r as g,n as M,j as t,s as z}from"./index-BXj9KiiF.js";import{H as L}from"./Header-Dl4dmuQR.js";import{B as u}from"./Button-CV-dwmT3.js";import{l as W,s as p,i as k,a as w,T as X,g as A}from"./progression-BHCe-Ar1.js";import{r as h,n as b,s as $}from"./time-WGOIUK2d.js";function F({player:d,onBack:q,onUpdatePlayer:v}){const[r,c]=g.useState(()=>W()),x=g.useMemo(()=>new Map(r.tasks.map(e=>[e.id,e])),[r.tasks]),y=g.useMemo(()=>r.active.filter(e=>e.kind==="quest"),[r.active]),R=g.useMemo(()=>r.tasks.filter(e=>e.kind==="quest"),[r.tasks,d.progress.level]);g.useEffect(()=>{const e=setInterval(()=>{const s=r.active.filter(a=>h(a.endsAt)<=0);if(s.length===0)return;const i=r.active.filter(a=>h(a.endsAt)>0),n=[...r.vault];for(const a of s){const o=x.get(a.id);o&&(n.push({id:o.id,kind:"quest",title:o.title,reward:o.reward,completedAt:b()}),M("quest",o.title,o.reward))}const l={...r,active:i,vault:n};c(l),p(l)},1e3);return()=>clearInterval(e)},[r,x]);function S(e){return r.active.filter(s=>s.kind===e).length}function T(e){var l;try{if(k(w())){alert("Ð¡ÐµÐ¹Ñ‡Ð°Ñ Ð¸Ð´ÐµÑ‚ Ð±Ð¾Ð¹ Ñ Ð¼Ð¾Ð½ÑÑ‚Ñ€Ð¾Ð¼. ÐšÐ²ÐµÑÑ‚Ñ‹ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹.");return}}catch(a){}const s=(l=e.costEnergy)!=null?l:0;if(s>0&&d.energy<s){alert("ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ ÑÐ½ÐµÑ€Ð³Ð¸Ð¸");return}if(S("quest")>=r.limits.quest){alert("Ð”Ð¾ÑÑ‚Ð¸Ð³Ð½ÑƒÑ‚ Ð»Ð¸Ð¼Ð¸Ñ‚ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ… ÐºÐ²ÐµÑÑ‚Ð¾Ð²: ".concat(r.limits.quest));return}const i={id:e.id,kind:"quest",startedAt:b(),endsAt:b()+$(e.durationSec)},n={...r,active:[...r.active,i]};if(c(n),p(n),s>0){const a={...d,energy:Math.max(0,d.energy-s)};z(a),v(a)}}function C(e){const s=r.active.filter(n=>!(n.kind==="quest"&&n.id===e.id&&n.startedAt===e.startedAt)),i={...r,active:s};c(i),p(i)}function I(e){const s=r.vault.filter(l=>l!==e),i={...r,vault:s};c(i),p(i);const n=A(d,e.reward);v(n)}function B(){let e=d;for(const i of r.vault)e=A(e,i.reward);v(e);const s={...r,vault:[]};c(s),p(s)}return t.jsxs("div",{style:{padding:16,display:"grid",gap:12},children:[(()=>{try{return k(w())}catch(e){return!1}})()&&t.jsxs("section",{style:{padding:12,borderRadius:16,background:"var(--panel-bg)",border:"var(--panel-border)"},children:[t.jsx("b",{children:"Ð¡ÐµÐ¹Ñ‡Ð°Ñ Ð¸Ð´ÐµÑ‚ Ð±Ð¾Ð¹ Ñ Ð¼Ð¾Ð½ÑÑ‚Ñ€Ð¾Ð¼"}),t.jsx("div",{style:{opacity:.85,marginTop:6},children:"Ð’Ð¾ Ð²Ñ€ÐµÐ¼Ñ Ð±Ð¾Ñ Ð½ÐµÐ»ÑŒÐ·Ñ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÑ‚ÑŒ ÐºÐ²ÐµÑÑ‚Ñ‹. Ð’ÐµÑ€Ð½Ð¸Ñ‚ÐµÑÑŒ Ð¿Ð¾ÑÐ»Ðµ Ð¾ÐºÐ¾Ð½Ñ‡Ð°Ð½Ð¸Ñ Ð±Ð¾Ñ."})]}),t.jsx(L,{title:"ÐšÐ²ÐµÑÑ‚Ñ‹",gold:d.gold,energy:d.energy,level:d.progress.level,onBack:q}),t.jsxs("section",{style:{padding:12,borderRadius:16,background:"var(--panel-bg)",border:"var(--panel-border)"},children:[t.jsx("b",{children:"ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ ÐºÐ²ÐµÑÑ‚Ñ‹"}),t.jsxs("div",{style:{display:"grid",gap:8,marginTop:8},children:[y.length===0&&t.jsx("div",{style:{opacity:.8},children:"ÐŸÐ¾ÐºÐ° Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ."}),y.map(e=>{var i,n;const s=x.get(e.id);return s?t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 12px",borderRadius:12,background:"var(--panel-bg)",border:"1px solid rgba(255,255,255,0.08)"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:700},children:s.title}),t.jsxs("div",{style:{opacity:.85,fontSize:12},children:["ÐÐ°Ð³Ñ€Ð°Ð´Ð°: ðŸª™ ",(i=s.reward.gold)!=null?i:0," â€¢ XP ",(n=s.reward.xp)!=null?n:0,s.reward.energy?" â€¢ ÑÐ½ÐµÑ€Ð³Ð¸Ñ +".concat(s.reward.energy):""]})]}),t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsx(X,{endsAt:e.endsAt}),t.jsx(u,{onClick:()=>C(e),disabled:h(e.endsAt)<2e3,children:"ÐžÑ‚Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ"})]})]},e.startedAt+e.id):null})]})]}),t.jsxs("section",{style:{padding:12,borderRadius:16,background:"var(--panel-bg)",border:"var(--panel-border)"},children:[t.jsx("b",{children:"Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ ÐºÐ²ÐµÑÑ‚Ñ‹"}),t.jsx("div",{style:{display:"grid",gap:8,marginTop:8},children:R.map(e=>{var n,l,a,o,j,f,m;const s=!!y.find(E=>E.id===e.id),i=((n=e.costEnergy)!=null?n:0)>d.energy||s||d.progress.level<((l=e.requiredLevel)!=null?l:1);return t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 12px",borderRadius:12,background:"var(--panel-bg)",border:"1px solid rgba(255,255,255,0.08)"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:700},children:e.title}),t.jsx("div",{style:{opacity:.85,fontSize:12},children:e.desc}),d.progress.level<((a=e.requiredLevel)!=null?a:1)&&t.jsxs("div",{style:{opacity:.85,fontSize:12,marginTop:4,color:"#e7a"},children:["Ð¢Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ ÑƒÑ€. ",(o=e.requiredLevel)!=null?o:1]}),t.jsxs("div",{style:{opacity:.85,fontSize:12,marginTop:4},children:["Ð”Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ: ",e.durationSec/60," Ð¼Ð¸Ð½ â€¢ Ð¦ÐµÐ½Ð°: âš¡ ",(j=e.costEnergy)!=null?j:0," â€¢ ÐÐ°Ð³Ñ€Ð°Ð´Ð°: ðŸª™ ",(f=e.reward.gold)!=null?f:0," â€¢ XP ",(m=e.reward.xp)!=null?m:0]})]}),t.jsx(u,{disabled:i,onClick:()=>T(e),children:s?"Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ":"ÐÐ°Ñ‡Ð°Ñ‚ÑŒ"})]},e.id)})})]}),t.jsxs("section",{style:{padding:12,borderRadius:16,background:"var(--panel-bg)",border:"var(--panel-border)"},children:[t.jsx("b",{children:"Ð¡ÐºÐ»Ð°Ð´ Ð½Ð°Ð³Ñ€Ð°Ð´"}),t.jsx("div",{style:{display:"flex",gap:8,marginTop:8},children:t.jsx(u,{onClick:B,disabled:r.vault.length===0,children:"Ð—Ð°Ð±Ñ€Ð°Ñ‚ÑŒ Ð²ÑÑ‘"})}),t.jsxs("div",{style:{display:"grid",gap:8,marginTop:10},children:[r.vault.length===0&&t.jsx("div",{style:{opacity:.8},children:"ÐŸÑƒÑÑ‚Ð¾."}),r.vault.map(e=>{var s,i;return t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 12px",borderRadius:12,background:"var(--panel-bg)",border:"1px solid rgba(255,255,255,0.08)"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:700},children:e.title}),t.jsxs("div",{style:{opacity:.85,fontSize:12},children:["ÐÐ°Ð³Ñ€Ð°Ð´Ð°: ðŸª™ ",(s=e.reward.gold)!=null?s:0," â€¢ XP ",(i=e.reward.xp)!=null?i:0,e.reward.energy?" â€¢ ÑÐ½ÐµÑ€Ð³Ð¸Ñ +".concat(e.reward.energy):""]})]}),t.jsx(u,{onClick:()=>I(e),children:"Ð—Ð°Ð±Ñ€Ð°Ñ‚ÑŒ"})]},e.completedAt+e.id)})]})]})]})}export{F as default};
